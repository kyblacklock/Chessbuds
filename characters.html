<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chessbuds — Characters</title>
<link rel="icon" type="image/png" href="King Favicon.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&family=Instrument+Serif:ital@0;1&display=swap">
<link rel="stylesheet" href="styles.css">
<style>
  body {
    min-height: 100vh;
    overflow-x: hidden;
  }

  #game-title {
    text-decoration: none;
    pointer-events: auto;
    transition: opacity 0.3s ease;
  }

  #game-title:hover { opacity: 0.8; }

  /* ── Page header ── */
  .page-header {
    padding-top: 120px;
    text-align: center;
    margin-bottom: 16px;
  }

  .page-header h1 {
    font-family: 'Instrument Serif', Georgia, serif;
    font-weight: 400;
    font-style: italic;
    font-size: 48px;
    letter-spacing: -0.02em;
    color: var(--text);
    opacity: 0;
    transform: translateY(20px);
    animation: fadeUp 0.8s ease forwards;
  }

  .page-header p {
    font-size: 14px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-top: 12px;
    opacity: 0;
    transform: translateY(12px);
    animation: fadeUp 0.8s ease 0.15s forwards;
  }

  /* ── Shelf Grid ── */
  #shelf-view {
    max-width: 1060px;
    margin: 0 auto;
    padding: 40px 40px 120px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 40px 36px;
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  #shelf-view.hidden {
    opacity: 0;
    pointer-events: none;
    position: absolute;
    transform: scale(0.97);
  }

  /* ── Character Card ── */
  .char-card {
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    opacity: 0;
    transform: translateY(30px);
    animation: fadeUp 0.7s ease forwards;
    perspective: 800px;
  }

  .char-card:nth-child(1) { animation-delay: 0.15s; }
  .char-card:nth-child(2) { animation-delay: 0.25s; }
  .char-card:nth-child(3) { animation-delay: 0.35s; }
  .char-card:nth-child(4) { animation-delay: 0.45s; }
  .char-card:nth-child(5) { animation-delay: 0.55s; }
  .char-card:nth-child(6) { animation-delay: 0.65s; }

  .card-tilt {
    width: 100%;
    transition: transform 0.15s ease-out;
    transform-style: preserve-3d;
    will-change: transform;
  }

  .card-face {
    position: relative;
    width: 100%;
    aspect-ratio: 5 / 7;
    border-radius: 16px;
    overflow: hidden;
    background: linear-gradient(168deg, #1a1a18 0%, #141413 40%, #0f0f0e 100%);
    border: 1px solid rgba(255, 255, 255, 0.07);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: border-color 0.4s ease, box-shadow 0.4s ease;
  }

  .char-card:hover .card-face {
    border-color: rgba(212, 165, 116, 0.25);
    box-shadow:
      0 25px 50px rgba(0, 0, 0, 0.5),
      0 0 0 1px rgba(212, 165, 116, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.04);
  }

  /* Inner card frame — playing card border */
  .card-frame {
    position: absolute;
    inset: 10px;
    border: 1px solid rgba(255, 255, 255, 0.04);
    border-radius: 10px;
    pointer-events: none;
    transition: border-color 0.4s ease;
  }

  .char-card:hover .card-frame {
    border-color: rgba(212, 165, 116, 0.12);
  }

  /* Corner accents */
  .card-corner {
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    pointer-events: none;
    z-index: 2;
  }

  .card-corner.top { top: 18px; left: 20px; }
  .card-corner.bottom { bottom: 18px; right: 20px; transform: rotate(180deg); }

  .card-corner .corner-role {
    font-family: 'Instrument Serif', Georgia, serif;
    font-style: italic;
    font-size: 14px;
    color: var(--text-muted);
    line-height: 1;
    transition: color 0.4s ease;
  }

  .char-card:hover .card-corner .corner-role {
    color: var(--accent);
  }

  .card-corner .corner-pip {
    font-size: 9px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-muted);
    opacity: 0.5;
    transition: color 0.4s ease, opacity 0.4s ease;
  }

  .char-card:hover .card-corner .corner-pip {
    color: var(--accent);
    opacity: 0.6;
  }

  /* Character image — centered */
  .char-img-wrap {
    position: relative;
    z-index: 1;
    width: 62%;
    height: 62%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .char-card:hover .char-img-wrap {
    transform: scale(1.04);
  }

  .char-img-wrap img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    filter: drop-shadow(0 6px 20px rgba(0, 0, 0, 0.5));
    transition: filter 0.4s ease;
  }

  .char-card:hover .char-img-wrap img {
    filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.6)) drop-shadow(0 0 40px rgba(212, 165, 116, 0.08));
  }

  /* Spotlight glow behind character */
  .card-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 70%;
    height: 70%;
    background: radial-gradient(ellipse, rgba(212, 165, 116, 0.04) 0%, transparent 70%);
    pointer-events: none;
    transition: opacity 0.4s ease;
    opacity: 0;
  }

  .char-card:hover .card-glow {
    opacity: 1;
  }

  /* Card background scene illustration */
  .card-bg {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    border-radius: 16px;
    opacity: 0.15;
    filter: blur(1.5px) saturate(0.5) brightness(0.6);
    transition: opacity 0.6s ease, filter 0.6s ease;
    z-index: 0;
  }

  .card-bg::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 16px;
    background: linear-gradient(to top,
      rgba(14, 14, 13, 0.95) 0%,
      rgba(14, 14, 13, 0.6) 40%,
      rgba(14, 14, 13, 0.4) 70%,
      rgba(14, 14, 13, 0.55) 100%
    );
  }

  .char-card:hover .card-bg {
    opacity: 0.5;
    filter: blur(0.5px) saturate(0.7) brightness(0.7);
  }

  /* Holographic shine overlay */
  .card-shine {
    position: absolute;
    inset: 0;
    border-radius: 16px;
    pointer-events: none;
    z-index: 5;
    opacity: 0;
    transition: opacity 0.3s ease;
    background: radial-gradient(
      circle at var(--shine-x, 50%) var(--shine-y, 50%),
      rgba(255, 255, 255, 0.12) 0%,
      rgba(212, 165, 116, 0.06) 25%,
      transparent 60%
    );
    mix-blend-mode: screen;
  }

  .char-card:hover .card-shine {
    opacity: 1;
  }

  /* Card bottom name bar */
  .card-name-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 20px 20px 22px;
    text-align: center;
    z-index: 2;
    background: linear-gradient(to top, rgba(14, 14, 13, 0.95) 0%, rgba(14, 14, 13, 0.6) 60%, transparent 100%);
  }

  .card-name-bar .char-name {
    font-family: 'Instrument Serif', Georgia, serif;
    font-style: italic;
    font-weight: 400;
    font-size: 18px;
    letter-spacing: -0.01em;
    color: var(--text);
    transition: color 0.3s ease;
  }

  .char-card:hover .card-name-bar .char-name {
    color: var(--accent);
  }

  /* ── Detail View ── */
  #detail-view {
    display: none;
    max-width: 1100px;
    margin: 0 auto;
    padding: 100px 40px 40px;
    opacity: 0;
    transform: translateY(16px);
  }

  #detail-view.active {
    display: block;
    animation: fadeUp 0.6s ease forwards;
  }

  .detail-back {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    font-weight: 500;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text-dim);
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-bottom: 48px;
    border: none;
    background: none;
    padding: 10px 0;
  }

  .detail-back:hover { color: var(--text); }

  .detail-back svg {
    width: 16px;
    height: 16px;
    stroke: currentColor;
    transition: transform 0.2s ease;
  }

  .detail-back:hover svg {
    transform: translateX(-3px);
  }

  .detail-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
    align-items: start;
    padding-right: 40px;
  }

  .detail-illustration {
    position: sticky;
    top: 120px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .detail-img-frame {
    position: relative;
    width: 100%;
    max-width: 400px;
    aspect-ratio: 5 / 7;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 20px;
    background: linear-gradient(168deg, #1a1a18 0%, #141413 40%, #0f0f0e 100%);
    border: 1px solid rgba(255, 255, 255, 0.07);
    overflow: hidden;
  }

  .detail-img-frame::before {
    content: '';
    position: absolute;
    inset: 10px;
    border: 1px solid rgba(212, 165, 116, 0.1);
    border-radius: 14px;
    pointer-events: none;
    z-index: 3;
  }

  .detail-img-frame::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 70%;
    height: 70%;
    background: radial-gradient(ellipse, rgba(212, 165, 116, 0.06) 0%, transparent 70%);
    pointer-events: none;
    z-index: 2;
  }

  .detail-bg {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    border-radius: 20px;
    opacity: 0.35;
    filter: blur(1px) saturate(0.6) brightness(0.55);
    z-index: 0;
  }

  .detail-bg::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 20px;
    background: linear-gradient(to top,
      rgba(14, 14, 13, 0.85) 0%,
      rgba(14, 14, 13, 0.35) 40%,
      rgba(14, 14, 13, 0.25) 65%,
      rgba(14, 14, 13, 0.45) 100%
    );
  }

  .detail-img-frame img {
    position: relative;
    z-index: 1;
    max-width: 70%;
    max-height: 80%;
    object-fit: contain;
    filter: drop-shadow(0 12px 40px rgba(0, 0, 0, 0.4));
    animation: floatPiece 6s ease-in-out infinite;
  }

  .detail-text {
    padding-top: 24px;
  }

  .detail-role {
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 12px;
    opacity: 0;
    transform: translateY(10px);
    animation: fadeUp 0.5s ease 0.2s forwards;
  }

  .detail-name {
    font-family: 'Instrument Serif', Georgia, serif;
    font-weight: 400;
    font-style: italic;
    font-size: 44px;
    letter-spacing: -0.02em;
    color: var(--text);
    line-height: 1.1;
    margin-bottom: 12px;
    opacity: 0;
    transform: translateY(10px);
    animation: fadeUp 0.5s ease 0.3s forwards;
  }

  .detail-epithet {
    font-family: 'Instrument Serif', Georgia, serif;
    font-style: italic;
    font-size: 18px;
    color: var(--text-dim);
    margin-bottom: 40px;
    opacity: 0;
    transform: translateY(10px);
    animation: fadeUp 0.5s ease 0.35s forwards;
  }

  .detail-divider {
    width: 40px;
    height: 1px;
    background: var(--accent-dim);
    margin-bottom: 40px;
    opacity: 0;
    animation: fadeUp 0.5s ease 0.4s forwards;
  }

  .detail-bio {
    font-size: 15.5px;
    font-weight: 300;
    line-height: 1.85;
    color: var(--text-dim);
    opacity: 0;
    transform: translateY(10px);
    animation: fadeUp 0.6s ease 0.45s forwards;
  }

  .detail-bio p { margin-bottom: 24px; }

  .detail-bio p:first-child::first-letter {
    font-family: 'Instrument Serif', Georgia, serif;
    font-style: italic;
    font-size: 52px;
    float: left;
    line-height: 0.85;
    margin-right: 8px;
    margin-top: 6px;
    color: var(--accent);
  }

  /* ── Piece Section ── */
  .detail-piece-section {
    display: grid;
    grid-template-columns: 380px 1fr;
    gap: 28px;
    align-items: stretch;
    margin-top: 64px;
    opacity: 0;
    transform: translateY(10px);
    animation: fadeUp 0.5s ease 0.5s forwards;
  }

  .piece-info {
    padding: 24px;
    border-radius: 16px;
    background: linear-gradient(168deg, rgba(26, 26, 24, 0.6) 0%, rgba(20, 20, 18, 0.4) 100%);
    border: 1px solid var(--border);
  }

  .piece-info-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
  }

  .piece-info-icon {
    width: 44px;
    height: 44px;
    object-fit: contain;
    opacity: 0.85;
    filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));
  }

  .piece-info-role {
    font-size: 10px;
    font-weight: 500;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 4px;
  }

  .piece-info-name {
    font-family: 'Instrument Serif', Georgia, serif;
    font-style: italic;
    font-size: 20px;
    color: var(--text);
    letter-spacing: -0.01em;
  }

  .piece-stats {
    display: flex;
    flex-direction: column;
  }

  .piece-stat {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    padding: 12px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.04);
  }

  .piece-stat:last-child { border-bottom: none; }

  .piece-stat-label {
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-muted);
    flex-shrink: 0;
  }

  .piece-stat-value {
    font-size: 13px;
    font-weight: 400;
    color: var(--text-dim);
    text-align: right;
  }

  .piece-stat-value.accent {
    color: var(--accent);
    font-family: 'Instrument Serif', Georgia, serif;
    font-style: italic;
    font-size: 20px;
  }

  .piece-move-section {
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
  }

  .piece-move-label {
    font-size: 10px;
    font-weight: 500;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 14px;
    text-align: center;
  }

  .piece-move-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 3px;
    width: 120px;
    margin: 0 auto;
  }

  .piece-move-cell {
    aspect-ratio: 1;
    border-radius: 3px;
    background: rgba(255, 255, 255, 0.025);
  }

  .piece-move-cell.active {
    background: rgba(212, 165, 116, 0.2);
    box-shadow: inset 0 0 0 1px rgba(212, 165, 116, 0.25);
  }

  .piece-move-cell.center {
    background: rgba(212, 165, 116, 0.45);
    box-shadow: inset 0 0 0 1px rgba(212, 165, 116, 0.5);
    border-radius: 4px;
  }

  .piece-quote {
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
    font-family: 'Instrument Serif', Georgia, serif;
    font-style: italic;
    font-size: 14px;
    line-height: 1.6;
    color: var(--text-muted);
  }

  .piece-viewer-container {
    position: relative;
    width: 100%;
    min-height: 400px;
    border-radius: 16px;
    overflow: hidden;
    background: linear-gradient(168deg, #141413 0%, #0f0f0e 50%, #0c0c0b 100%);
    border: 1px solid var(--border);
    cursor: grab;
  }

  .piece-viewer-container:active { cursor: grabbing; }

  .piece-viewer-container canvas {
    display: block;
    width: 100% !important;
    height: 100% !important;
  }

  .piece-viewer-hint {
    position: absolute;
    bottom: 14px;
    left: 50%;
    transform: translateX(-50%);
    font-family: 'DM Sans', sans-serif;
    font-size: 10px;
    font-weight: 500;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-muted);
    opacity: 0.5;
    pointer-events: none;
    transition: opacity 0.4s ease;
  }

  .piece-viewer-container.interacted .piece-viewer-hint {
    opacity: 0;
  }

  .piece-viewer-header {
    position: absolute;
    top: 16px;
    left: 18px;
    z-index: 3;
    font-size: 10px;
    font-weight: 500;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-muted);
    pointer-events: none;
  }

  .piece-viewer-loader {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
    pointer-events: none;
    transition: opacity 0.5s ease;
  }

  .piece-viewer-loader img {
    width: 48px;
    height: 48px;
    object-fit: contain;
    opacity: 0.25;
    animation: loaderPulse 2s ease-in-out infinite;
  }

  .piece-viewer-loader span {
    font-size: 10px;
    font-weight: 500;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-muted);
    opacity: 0.4;
  }

  .piece-viewer-container.loaded .piece-viewer-loader {
    opacity: 0;
  }

  /* ── Other Characters Nav ── */
  .detail-others {
    margin-top: 80px;
    padding-top: 48px;
    border-top: 1px solid var(--border);
    opacity: 0;
    transform: translateY(10px);
    animation: fadeUp 0.5s ease 0.55s forwards;
  }

  .detail-others-label {
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 20px;
  }

  .detail-others-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 12px;
  }

  .other-card {
    cursor: pointer;
    border-radius: 12px;
    overflow: hidden;
    background: linear-gradient(168deg, #1a1a18 0%, #141413 40%, #0f0f0e 100%);
    border: 1px solid var(--border);
    aspect-ratio: 5 / 7;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: all 0.3s ease;
  }

  .other-card:hover {
    border-color: rgba(212, 165, 116, 0.25);
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
  }

  .other-card img {
    position: relative;
    z-index: 1;
    max-width: 60%;
    max-height: 55%;
    object-fit: contain;
    filter: drop-shadow(0 4px 10px rgba(0,0,0,0.4));
    transition: transform 0.3s ease;
  }

  .other-card:hover img {
    transform: scale(1.06);
  }

  .other-card-name {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 1;
    padding: 10px 6px;
    text-align: center;
    background: linear-gradient(to top, rgba(14,14,13,0.95), transparent);
    font-family: 'Instrument Serif', Georgia, serif;
    font-style: italic;
    font-size: 12px;
    color: var(--text-dim);
    transition: color 0.3s ease;
  }

  .other-card:hover .other-card-name {
    color: var(--accent);
  }

  /* Other card background scene */
  .other-card-bg {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    border-radius: 12px;
    opacity: 0.12;
    filter: blur(1px) saturate(0.4) brightness(0.5);
    transition: opacity 0.4s ease, filter 0.4s ease;
    z-index: 0;
  }

  .other-card-bg::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 12px;
    background: linear-gradient(to top, rgba(14, 14, 13, 0.95) 0%, rgba(14, 14, 13, 0.5) 100%);
  }

  .other-card:hover .other-card-bg {
    opacity: 0.3;
    filter: blur(0px) saturate(0.6) brightness(0.6);
  }

  /* ── Bottom CTA Section ── */
  .detail-cta {
    margin-top: 32px;
    padding: 24px 24px 28px;
    text-align: center;
    border-top: 1px solid var(--border);
    opacity: 0;
    transform: translateY(10px);
    animation: fadeUp 0.5s ease 0.6s forwards;
  }

  .detail-cta-sub {
    font-size: 12px;
    font-weight: 400;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 16px;
  }

  .detail-cta a {
    display: inline-block;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    font-weight: 500;
    letter-spacing: 0.04em;
    color: var(--text-dim);
    background: transparent;
    text-decoration: none;
    padding: 10px 28px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    transition: all 0.2s ease;
  }

  .detail-cta a:hover {
    border-color: var(--border-hover);
    color: var(--text);
  }

  /* ── Animations ── */
  @keyframes fadeUp {
    to { opacity: 1; transform: translateY(0) scale(1); }
  }

  @keyframes floatPiece {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }

  @keyframes loaderPulse {
    0%, 100% { opacity: 0.25; transform: scale(1); }
    50% { opacity: 0.45; transform: scale(1.06); }
  }

  /* ── Profile Node ── */
  .profile-node {
    width: 34px;
    height: 34px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--surface);
    border: 1px solid var(--border);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 0;
    overflow: hidden;
    text-decoration: none;
  }

  .profile-node-icon {
    width: 20px;
    height: 20px;
    object-fit: contain;
    opacity: 0.6;
    transition: opacity 0.2s ease;
  }

  .profile-node:hover .profile-node-icon { opacity: 1; }

  .profile-node:hover {
    background: var(--surface-hover);
    border-color: var(--border-hover);
  }

  /* ── Responsive ── */
  @media (max-width: 900px) {
    #shelf-view {
      grid-template-columns: repeat(2, 1fr);
      padding: 32px 24px 100px;
      gap: 28px 20px;
    }

    .detail-layout {
      grid-template-columns: 1fr;
      gap: 48px;
    }

    .detail-illustration { position: static; align-items: center; }
    .detail-img-frame { max-width: 300px; }
    .detail-name { font-size: 36px; }
    .page-header h1 { font-size: 36px; }

    .detail-piece-section { grid-template-columns: 1fr; }
    .piece-viewer-container { min-height: 360px; height: auto; }
  }

  @media (max-width: 560px) {
    #shelf-view {
      grid-template-columns: repeat(2, 1fr);
      gap: 20px 14px;
      padding: 24px 16px 80px;
    }

    .card-name-bar .char-name { font-size: 14px; }
    .card-corner .corner-role { font-size: 12px; }

    .detail-others-grid { grid-template-columns: repeat(3, 1fr); }
    .detail-layout { gap: 32px; }
    #detail-view { padding: 90px 20px 32px; }
    .page-header { padding-top: 84px; }
    .page-header h1 { font-size: 30px; }

    .detail-piece-section { grid-template-columns: 1fr; gap: 24px; }
    .piece-info { padding: 20px; }
    .piece-viewer-container { min-height: 300px; }
  }

</style>
</head>
<body>

<!-- Navigation -->
<div id="top-bar">
  <a id="game-title" href="index.html">Chessbuds</a>
  <div class="nav-links">
    <a class="nav-link" href="characters.html">Characters</a>
    <a class="nav-link" href="index.html">Play Game</a>
    <a class="profile-node" href="index.html" title="Profile">
      <img class="profile-node-icon" src="King Favicon.png" alt="Profile">
    </a>
  </div>
</div>

<!-- Page Header -->
<div class="page-header">
  <h1>Meet the Chessbuds</h1>
  <p>Champions of the Board</p>
</div>

<!-- Shelf View -->
<div id="shelf-view"></div>

<!-- Detail View -->
<div id="detail-view">
  <button class="detail-back" onclick="hideDetail()">
    <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><polyline points="12 19 5 12 12 5"/></svg>
    All Characters
  </button>
  <div class="detail-layout">
    <div class="detail-illustration">
      <div class="detail-img-frame">
        <div class="detail-bg" id="detail-bg"></div>
        <img id="detail-img" src="" alt="" draggable="false">
      </div>
    </div>
    <div class="detail-text">
      <div class="detail-role" id="detail-role"></div>
      <h2 class="detail-name" id="detail-name"></h2>
      <div class="detail-epithet" id="detail-epithet"></div>
      <div class="detail-divider"></div>
      <div class="detail-bio" id="detail-bio"></div>
    </div>
  </div>

  <!-- Piece Section -->
  <div class="detail-piece-section" id="detail-piece-section">
    <div class="piece-info" id="piece-info">
      <div class="piece-info-header">
        <img class="piece-info-icon" id="piece-info-icon" src="" alt="">
        <div>
          <div class="piece-info-role" id="piece-info-role"></div>
          <div class="piece-info-name" id="piece-info-name"></div>
        </div>
      </div>
      <div class="piece-stats" id="piece-stats"></div>
      <div class="piece-move-section">
        <div class="piece-move-label">Movement Pattern</div>
        <div class="piece-move-grid" id="piece-move-grid"></div>
      </div>
      <div class="piece-quote" id="piece-quote"></div>
    </div>
    <div class="piece-viewer-container" id="piece-viewer-container">
      <div class="piece-viewer-header" id="piece-viewer-header"></div>
      <div class="piece-viewer-loader" id="piece-viewer-loader">
        <img id="piece-viewer-loader-icon" src="" alt="">
        <span>Loading</span>
      </div>
      <div class="piece-viewer-hint">Drag to rotate</div>
    </div>
  </div>

  <!-- Other Characters -->
  <div class="detail-others" id="detail-others">
    <div class="detail-others-label">Other Characters</div>
    <div class="detail-others-grid" id="detail-others-grid"></div>
  </div>

  <!-- Bottom CTA -->
  <div class="detail-cta">
    <p class="detail-cta-sub">New Chessbuds are on the way</p>
    <a href="waitlist.html">More Chessbuds</a>
  </div>
</div>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/"
  }
}
</script>

<script>

const characters = {
  king: {
    name: 'King Leo Longmane',
    role: 'King',
    pip: 'K',
    epithet: 'The Wise Sovereign of Chessbuds Kingdom',
    img: 'Character Illustrations/King.png',
    bg: 'Background Illustrations/King.png',
    stl: 'King.stl', stlHeight: 3.2,
    bio: `<p>Proud, regal and wise, King Leo Longmane is the very picture of courtly power and grace. Feared by his enemies and venerated by his subjects, the mighty Leo once united a realm through authority and compassion.</p><p>Yet heavy is the head that wears the crown, and a prolonged reign has taken its toll on the aged monarch. Still, while his steps may be slower than they once were, King Longmane rules with an iron paw. So long as he stands to fight, the battle for Chessbuds Kingdom is never over.</p>`
  },
  queen: {
    name: 'Queen Beatrix the Brave',
    role: 'Queen',
    pip: 'Q',
    epithet: 'The Sting of the Crown',
    img: 'Character Illustrations/Queen.png',
    bg: 'Background Illustrations/Queen.png',
    stl: 'Queen.stl', stlHeight: 2.9,
    bio: `<p>It is said that behind every great man there is an even greater woman. Yet Queen Beatrix stands behind no man — she towers over all, despite her bantam insectile stature. In taverns and pubs all across the kingdom, reverential stories are swapped of her multifaceted battle prowess, one that combines the agility of Big Bishop Bernard with the brute strength of Rook O'Roark.</p><p>There are even those who say (although never when King Leo is listening) that in this land, it is she who truly wears the crown, so to speak. Whether that is true or false, no one can say, but woe to the player who finds him or herself face to face with the Queen Bee, anywhere along the field of play.</p>`
  },
  bishop: {
    name: 'Big Bishop Bernard',
    role: 'Bishop',
    pip: 'B',
    epithet: 'The Right Hand of the King',
    img: 'Character Illustrations/Bishop.png',
    bg: 'Background Illustrations/Bishop.png',
    stl: 'Bishop.stl', stlHeight: 2.5,
    bgPos: '70% center',
    bio: `<p>As the voice of God and the right hand of the king, it's fair to say that Big Bishop Bernard knows a thing or two about playing the angles. One by one, his challengers have attempted to unseat his place in King Leo's affections, and one by one they have been turned back. Many are those who have measured themselves against the Bishop, and come up short.</p><p>Starting every battle in his honored position next to the king, Big Bernard's fast, cutting attacks are capable of tearing armies to shreds in a matter of minutes. Clad in a loose fitting tunic, the Bishop's true speed is hidden until the moment he leaps out from behind the wall of pawns towards the unsuspecting enemy. By that point, it is already too late.</p>`
  },
  knight: {
    name: 'Nigel Knight',
    role: 'Knight',
    pip: 'N',
    epithet: 'The Laughing Horse',
    img: 'Character Illustrations/Knight.png',
    bg: 'Background Illustrations/Knight.jpg',
    stl: 'Knight.stl', stlHeight: 2.3,
    bio: `<p>How to predict the actions of a madman? How indeed. As delusional as he is dangerous, "The Laughing Horse" zigzags across the battlefield to the confusion and horror of his foes, a lunatic grin plastered on his dappled muzzle.</p><p>Though when it comes to war, Sir Nigel does not horse around. A prodigious swordsman since he was just a pony, Nigel is considered the most creative and crafty warrior in King Longmane's army. As long as the knight remains on the board, no line of defense, no matter how well structured, is safe from his fabled blade.</p>`
  },
  rook: {
    name: "Rook O'Roark",
    role: 'Rook',
    pip: 'R',
    epithet: 'The Straight Shooter',
    img: 'Character Illustrations/Rook.png',
    bg: 'Background Illustrations/Rook.png',
    stl: 'Rook.stl', stlHeight: 2.0,
    bio: `<p>Rook O'Roark has always been a straight shooter. A war-torn veteran of a thousand battles, his cold, beady eyes have seen it all. Today, the "Dark Bird" has emerged as paragon of power and fear, overseeing the perimeter of King Leo's legendary legion from his castle perch high above.</p><p>Simple and straightforward, Rook has no time for the cross-eyed antics of Nigel the Knight. He prefers the direct attack, flying forwards, backwards, and sideways on strong raven wings that beat the air into submission. Now, O'Roark lives only for one thing\u2014 the clink of gold coins at the end of a fight in which, once again, his beak and talons prove too much for his weaker prey.</p>`
  },
  pawn: {
    name: 'Pawdrick the Pawn',
    role: 'Pawn',
    pip: 'P',
    epithet: 'The Valiant Squire',
    img: 'Character Illustrations/Pawn.png',
    bg: 'Background Illustrations/Pawn.png',
    stl: 'Pawn.stl', stlHeight: 1.7,
    bgPos: '70% center',
    bio: `<p>Don't let his size fool you — Pawdrick is as tough as they come! A valiant squire of humble origin, Pawdrick clawed his way out of strenuous serfdom to earn a coveted spot in King Longmane's retinue.</p><p>There are many who dismiss the Pawn, preferring to lather their attention on the larger players who stand behind him. But underestimate Pawdrick at your own peril; his courage and pluck have decided too many battles to count. Scrappy, loyal and steadfast, this little squirrel is honored to serve on the front line of Chessbuds Kingdom.</p>`
  }
};

const pieceData = {
  king: {
    icon: 'Piece Icons/White/King Icon White.png',
    value: '∞', movement: 'One square, any direction',
    range: 'Close', special: 'Castling',
    quote: 'So long as he stands to fight, the battle is never over.',
    pattern: [0,0,0,0,0, 0,1,1,1,0, 0,1,2,1,0, 0,1,1,1,0, 0,0,0,0,0]
  },
  queen: {
    icon: 'Piece Icons/White/Queen Icon White.png',
    value: '9', movement: 'Any direction, any distance',
    range: 'Unlimited', special: 'None',
    quote: 'Woe to the player who finds herself face to face with the Queen Bee.',
    pattern: [1,0,1,0,1, 0,1,1,1,0, 1,1,2,1,1, 0,1,1,1,0, 1,0,1,0,1]
  },
  bishop: {
    icon: 'Piece Icons/White/Bishop Icon Whitepng.png',
    value: '3', movement: 'Diagonals, any distance',
    range: 'Long', special: 'None',
    quote: 'It\u2019s fair to say that Big Bishop Bernard knows a thing or two about playing the angles.',
    pattern: [1,0,0,0,1, 0,1,0,1,0, 0,0,2,0,0, 0,1,0,1,0, 1,0,0,0,1]
  },
  knight: {
    icon: 'Piece Icons/White/Kinght Icon White.png',
    value: '3', movement: 'L-shape leap',
    range: 'Mid', special: 'Jumps over pieces',
    quote: 'No line of defense, no matter how well structured, is safe from his fabled blade.',
    pattern: [0,1,0,1,0, 1,0,0,0,1, 0,0,2,0,0, 1,0,0,0,1, 0,1,0,1,0]
  },
  rook: {
    icon: 'Piece Icons/White/Rook Icon White.png',
    value: '5', movement: 'Straight lines, any distance',
    range: 'Unlimited', special: 'Castling',
    quote: 'He prefers the direct attack, flying forwards, backwards, and sideways.',
    pattern: [0,0,1,0,0, 0,0,1,0,0, 1,1,2,1,1, 0,0,1,0,0, 0,0,1,0,0]
  },
  pawn: {
    icon: 'Piece Icons/White/Pawn Icon White.png',
    value: '1', movement: 'Forward one or two from start',
    range: 'Close', special: 'En passant, Promotion',
    quote: 'Underestimate Pawdrick at your own peril.',
    pattern: [0,0,1,0,0, 0,1,1,1,0, 0,0,2,0,0, 0,0,0,0,0, 0,0,0,0,0]
  }
};

// ── Build cards ──
const shelfView = document.getElementById('shelf-view');
const detailView = document.getElementById('detail-view');
const pageHeader = document.querySelector('.page-header');

const order = ['king', 'queen', 'bishop', 'knight', 'rook', 'pawn'];

order.forEach((key) => {
  const c = characters[key];
  const card = document.createElement('div');
  card.className = 'char-card';
  card.onclick = () => showDetail(key);

  card.innerHTML = `
    <div class="card-tilt">
      <div class="card-face">
        <div class="card-bg" style="background-image: url('${c.bg}'); background-position: ${c.bgPos || 'center'}"></div>
        <div class="card-frame"></div>
        <div class="card-corner top">
          <span class="corner-role">${c.pip}</span>
          <span class="corner-pip">${c.role}</span>
        </div>
        <div class="card-corner bottom">
          <span class="corner-role">${c.pip}</span>
          <span class="corner-pip">${c.role}</span>
        </div>
        <div class="card-glow"></div>
        <div class="char-img-wrap">
          <img src="${c.img}" alt="${c.name}" draggable="false">
        </div>
        <div class="card-name-bar">
          <div class="char-name">${c.name}</div>
        </div>
        <div class="card-shine"></div>
      </div>
    </div>
  `;
  shelfView.appendChild(card);
});

// ── 3D Tilt + Shine ──
document.querySelectorAll('.char-card').forEach(card => {
  const tilt = card.querySelector('.card-tilt');
  const shine = card.querySelector('.card-shine');

  card.addEventListener('mousemove', (e) => {
    const rect = card.getBoundingClientRect();
    const x = (e.clientX - rect.left) / rect.width;
    const y = (e.clientY - rect.top) / rect.height;

    const rotateY = (x - 0.5) * 14;
    const rotateX = (0.5 - y) * 14;

    tilt.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
    shine.style.setProperty('--shine-x', `${x * 100}%`);
    shine.style.setProperty('--shine-y', `${y * 100}%`);
  });

  card.addEventListener('mouseleave', () => {
    tilt.style.transform = 'rotateX(0deg) rotateY(0deg)';
  });
});

// ── Detail View ──
function showDetail(key) {
  const c = characters[key];
  if (!c) return;

  document.getElementById('detail-bg').style.backgroundImage = `url('${c.bg}')`;
  document.getElementById('detail-bg').style.backgroundPosition = c.bgPos || 'center';
  document.getElementById('detail-img').src = c.img;
  document.getElementById('detail-img').alt = c.name;
  document.getElementById('detail-role').textContent = c.role;
  document.getElementById('detail-name').textContent = c.name;
  document.getElementById('detail-epithet').textContent = c.epithet;
  document.getElementById('detail-bio').innerHTML = c.bio;

  // Populate piece info
  const pd = pieceData[key];
  document.getElementById('piece-info-icon').src = pd.icon;
  document.getElementById('piece-info-icon').alt = c.role;
  document.getElementById('piece-info-role').textContent = 'The Piece';
  document.getElementById('piece-info-name').textContent = c.role;

  const stats = [
    { label: 'Value', value: pd.value, accent: true },
    { label: 'Range', value: pd.range },
    { label: 'Movement', value: pd.movement },
    { label: 'Special', value: pd.special }
  ];
  document.getElementById('piece-stats').innerHTML = stats.map(s =>
    `<div class="piece-stat"><span class="piece-stat-label">${s.label}</span><span class="piece-stat-value${s.accent ? ' accent' : ''}">${s.value}</span></div>`
  ).join('');

  const moveGrid = document.getElementById('piece-move-grid');
  moveGrid.innerHTML = '';
  pd.pattern.forEach(cell => {
    const div = document.createElement('div');
    div.className = 'piece-move-cell' + (cell === 2 ? ' center' : cell === 1 ? ' active' : '');
    moveGrid.appendChild(div);
  });

  document.getElementById('piece-quote').textContent = '\u201C' + pd.quote + '\u201D';

  // Set up viewer loader
  document.getElementById('piece-viewer-header').textContent = c.role;
  document.getElementById('piece-viewer-loader-icon').src = pd.icon;
  document.getElementById('piece-viewer-container').classList.remove('loaded');

  // Build other characters grid
  const othersGrid = document.getElementById('detail-others-grid');
  othersGrid.innerHTML = '';
  order.filter(k => k !== key).forEach(k => {
    const o = characters[k];
    const card = document.createElement('div');
    card.className = 'other-card';
    card.onclick = (e) => { e.stopPropagation(); showDetail(k); };
    const shortNames = { king: 'Leo', queen: 'Beatrix', bishop: 'Bernard', knight: 'Nigel', rook: "O'Roark", pawn: 'Pawdrick' };
    card.innerHTML = `<div class="other-card-bg" style="background-image: url('${o.bg}'); background-position: ${o.bgPos || 'center'}"></div><img src="${o.img}" alt="${o.name}" draggable="false"><div class="other-card-name">${shortNames[k]}</div>`;
    othersGrid.appendChild(card);
  });

  shelfView.classList.add('hidden');
  pageHeader.style.display = 'none';

  detailView.classList.remove('active');
  void detailView.offsetWidth;
  detailView.classList.add('active');

  detailView.querySelectorAll('.detail-role, .detail-name, .detail-epithet, .detail-divider, .detail-bio, .detail-piece-section, .detail-others, .detail-cta').forEach(el => {
    el.style.animation = 'none';
    void el.offsetWidth;
    el.style.animation = '';
  });

  window.scrollTo({ top: 0, behavior: 'instant' });
  history.pushState({ character: key }, '', `#${key}`);

  // Load 3D piece viewer — module script may not be ready yet
  window._pendingPieceLoad = { stl: c.stl, height: c.stlHeight };
  if (window.loadPieceViewer) {
    requestAnimationFrame(() => window.loadPieceViewer(c.stl, c.stlHeight));
  }
}

function hideDetail() {
  if (window.disposePieceViewer) window.disposePieceViewer();
  detailView.classList.remove('active');
  pageHeader.style.display = '';
  shelfView.classList.remove('hidden');

  document.querySelectorAll('.char-card').forEach(card => {
    card.style.animation = 'none';
    void card.offsetWidth;
    card.style.animation = '';
  });

  window.scrollTo({ top: 0, behavior: 'instant' });
  history.pushState(null, '', window.location.pathname);
}

window.addEventListener('popstate', (e) => {
  if (e.state && e.state.character) {
    showDetail(e.state.character);
  } else {
    hideDetail();
  }
});

if (window.location.hash) {
  const key = window.location.hash.slice(1);
  if (characters[key]) showDetail(key);
}

</script>

<script type="module">
import * as THREE from 'three';
import { STLLoader } from 'three/addons/loaders/STLLoader.js';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import * as BufferGeometryUtils from 'three/addons/utils/BufferGeometryUtils.js';

let viewerScene, viewerCamera, viewerRenderer, viewerControls;
let viewerPiece, viewerAnimId;
let viewerInitialized = false;

function initViewer() {
  const container = document.getElementById('piece-viewer-container');
  const rect = container.getBoundingClientRect();

  viewerScene = new THREE.Scene();

  viewerCamera = new THREE.PerspectiveCamera(32, rect.width / rect.height, 0.1, 100);
  viewerCamera.position.set(0, 3, 7);

  viewerRenderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  viewerRenderer.setSize(rect.width, rect.height);
  viewerRenderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  viewerRenderer.toneMapping = THREE.ACESFilmicToneMapping;
  viewerRenderer.toneMappingExposure = 1.2;
  container.insertBefore(viewerRenderer.domElement, container.firstChild);

  viewerControls = new OrbitControls(viewerCamera, viewerRenderer.domElement);
  viewerControls.target.set(0, 1.2, 0);
  viewerControls.enableDamping = true;
  viewerControls.dampingFactor = 0.08;
  viewerControls.enableZoom = true;
  viewerControls.minDistance = 4;
  viewerControls.maxDistance = 14;
  viewerControls.enablePan = false;
  viewerControls.maxPolarAngle = Math.PI / 2;
  viewerControls.minPolarAngle = Math.PI / 8;
  viewerControls.autoRotate = true;
  viewerControls.autoRotateSpeed = 1.5;

  // Hide hint on interaction
  viewerControls.addEventListener('start', () => {
    container.classList.add('interacted');
  });

  // Lighting
  const ambient = new THREE.AmbientLight(0xFFE8CC, 0.5);
  viewerScene.add(ambient);

  const key = new THREE.DirectionalLight(0xFFCC88, 2.0);
  key.position.set(4, 10, 6);
  viewerScene.add(key);

  const fill = new THREE.DirectionalLight(0x8899BB, 0.6);
  fill.position.set(-6, 6, -4);
  viewerScene.add(fill);

  const rim = new THREE.DirectionalLight(0xFFAA55, 0.5);
  rim.position.set(-2, 4, 8);
  viewerScene.add(rim);

  // Ground plane (subtle)
  const groundGeo = new THREE.CircleGeometry(3, 48);
  const groundMat = new THREE.MeshStandardMaterial({
    color: 0x1a1816, roughness: 0.9, metalness: 0
  });
  const ground = new THREE.Mesh(groundGeo, groundMat);
  ground.rotation.x = -Math.PI / 2;
  ground.position.y = 0;
  viewerScene.add(ground);

  viewerInitialized = true;

  // Resize observer
  const ro = new ResizeObserver(() => {
    const r = container.getBoundingClientRect();
    if (r.width === 0 || r.height === 0) return;
    viewerCamera.aspect = r.width / r.height;
    viewerCamera.updateProjectionMatrix();
    viewerRenderer.setSize(r.width, r.height);
  });
  ro.observe(container);
  viewerRenderer.userData = { resizeObserver: ro };
}

function processGeometry(geometry, targetHeight) {
  let geo = BufferGeometryUtils.mergeVertices(geometry, 0.0005);
  geo.computeBoundingBox();
  const bb = geo.boundingBox;
  const center = new THREE.Vector3();
  bb.getCenter(center);
  const size = new THREE.Vector3();
  bb.getSize(size);
  const scale = targetHeight / Math.max(size.x, size.y, size.z);

  const posArr = geo.getAttribute('position').array;
  for (let i = 0; i < posArr.length; i += 3) {
    posArr[i]   = (posArr[i]   - center.x) * scale;
    posArr[i+1] = (posArr[i+1] - bb.min.y) * scale;
    posArr[i+2] = (posArr[i+2] - center.z) * scale;
  }
  geo.getAttribute('position').needsUpdate = true;
  geo.computeBoundingBox();
  geo.computeVertexNormals();
  return geo;
}

async function loadPieceViewer(stlFile, stlHeight) {
  if (!viewerInitialized) initViewer();

  // Remove previous piece
  if (viewerPiece) {
    viewerScene.remove(viewerPiece);
    viewerPiece.geometry.dispose();
    viewerPiece = null;
  }

  // Reset hint
  document.getElementById('piece-viewer-container').classList.remove('interacted');

  // Reset camera
  viewerCamera.position.set(0, 3, 7);
  viewerControls.target.set(0, 1.2, 0);
  viewerControls.update();

  try {
    const response = await fetch(stlFile);
    const buffer = await response.arrayBuffer();
    const loader = new STLLoader();
    let geometry = loader.parse(buffer);
    geometry = processGeometry(geometry, stlHeight);

    const material = new THREE.MeshPhysicalMaterial({
      color: 0xFAF0E0,
      roughness: 0.15,
      metalness: 0.0,
      clearcoat: 0.8,
      clearcoatRoughness: 0.15,
      envMapIntensity: 0.4,
      sheen: 0.3,
      sheenColor: new THREE.Color(0xFFF8EE)
    });

    viewerPiece = new THREE.Mesh(geometry, material);
    viewerPiece.castShadow = true;
    viewerScene.add(viewerPiece);
    document.getElementById('piece-viewer-container').classList.add('loaded');
  } catch (e) {
    console.warn('Failed to load piece STL:', e);
    document.getElementById('piece-viewer-container').classList.add('loaded');
  }

  // Start render loop if not running
  if (!viewerAnimId) animateViewer();
}

function animateViewer() {
  viewerAnimId = requestAnimationFrame(animateViewer);
  if (!viewerRenderer) return;
  viewerControls.update();
  viewerRenderer.render(viewerScene, viewerCamera);
}

function disposePieceViewer() {
  if (viewerAnimId) {
    cancelAnimationFrame(viewerAnimId);
    viewerAnimId = null;
  }
  if (viewerPiece) {
    viewerScene.remove(viewerPiece);
    viewerPiece.geometry.dispose();
    viewerPiece.material.dispose();
    viewerPiece = null;
  }
  if (viewerRenderer) {
    viewerRenderer.userData.resizeObserver?.disconnect();
    viewerRenderer.domElement.remove();
    viewerRenderer.dispose();
    viewerRenderer = null;
  }
  viewerInitialized = false;
}

window.loadPieceViewer = loadPieceViewer;
window.disposePieceViewer = disposePieceViewer;

// Fulfill any pending load request from classic script
if (window._pendingPieceLoad) {
  const { stl, height } = window._pendingPieceLoad;
  delete window._pendingPieceLoad;
  requestAnimationFrame(() => loadPieceViewer(stl, height));
}
</script>
</body>
</html>
